!function e(t,r,a){function i(n,s){if(!r[n]){if(!t[n]){var d="function"==typeof require&&require;if(!s&&d)return d(n,!0);if(o)return o(n,!0);throw new Error("Cannot find module '"+n+"'")}var c=r[n]={exports:{}};t[n][0].call(c.exports,function(e){var r=t[n][1][e];return i(r?r:e)},c,c.exports,e,t,r,a)}return r[n].exports}for(var o="function"==typeof require&&require,n=0;n<a.length;n++)i(a[n]);return i}({1:[function(e,t,r){"use strict";var a=e("../utils/loading.js"),i=e("../utils/format-date-time.js"),o=e("../common/current-user-info.js"),n=e("../common/order-filters-config.js"),s=e("../orders/modules/order-search.js"),d=e("../orders/modules/order-tab-filter.js"),c=e("../orders/modules/order-data-grid.js"),l=e("../orders/modules/order-detail.js"),u=e("../orders/modules/order-detail-basic-info.js"),p=e("../orders/modules/order-detail-product-msg.js"),h=e("../orders/modules/order-detail-receiver-msg.js"),g=e("../orders/modules/order-detail-finance-msg.js"),f=e("../orders/modules/order-detail-invoice-msg.js"),b=e("../orders/modules/order-detail-depot-msg.js"),m=e("../orders/modules/order-detail-operation-log.js"),v=e("../orders/modules/order-detail-return-info.js"),O=e("../orders/modules/order-detail-return-log.js"),j=e("../orders/modules/order-detail-purchase-log.js"),_=e("../orders/modules/order-operations.js"),k=e("../orders/modules/order-operations-config.js"),S=e("../orders/modules/order-operations-lock-unlock.js"),D=e("../orders/modules/order-operations-check.js"),C=e("../orders/modules/order-operations-cut.js"),y=e("../orders/modules/order-operations-merge.js"),w=e("../orders/modules/order-operations-separate.js"),T=e("../orders/modules/order-operations-check-revert.js"),L=e("../orders/modules/order-operations-mark.js"),x=e("../orders/modules/order-operations-cancel.js"),P=e("../orders/modules/order-operations-pause-restart.js");window.orders={loadingBox:a,formatDateTime:i,orderCurrentUser:o,orderFilters:n,orderSearch:s,orderTabFilter:d,orderDataGrid:c,orderDetail:l,orderDetailBasicInfo:u,orderDetailProductMsg:p,orderDetailReceiverMsg:h,orderDetailFinanceMsg:g,orderDetailOperationLog:m,orderDetailReturnInfo:v,orderDetailReturnLog:O,orderDetailPurchaseLog:j,orderDetailDepotMsg:b,orderDetailInvoiceMsg:f,orderOperations:_,orderOperationsConfig:k,orderOperationsLockUnLock:S,orderOperationsCheck:D,orderOperationsCut:C,orderOperationsMerge:y,orderOperationsSeparate:w,orderOperationsCheckRevert:T,orderOperationsMark:L,orderOperationsCancel:x,orderOperationsPauseRestart:P,init:function(){$.jgrid.no_legacy_api=!0,$.jgrid.useJSON=!0,this.needMockData=SYS_VARS.NEED_MOCK_DATA||!1,this.orderCurrentUser.init({pageObj:this,callBack:this.loadPageData.bind(this)})},loadPageData:function(){this.orderSearch.init({pageObj:this}),this.orderTabFilter.init({pageObj:this}),this.orderDataGrid.init({pageObj:this,needMockData:SYS_VARS.NEED_MOCK_DATA||!1}),this.orderOperations.init({pageObj:this}),this.orderOperationsLockUnLock.init({pageObj:this}),this.orderOperationsCheck.init({pageObj:this}),this.orderOperationsCut.init({pageObj:this}),this.orderOperationsMerge.init({pageObj:this}),this.orderOperationsSeparate.init({pageObj:this}),this.orderOperationsCheckRevert.init({pageObj:this}),this.orderOperationsMark.init({pageObj:this}),this.orderOperationsCancel.init({pageObj:this}),this.orderOperationsPauseRestart.init({pageObj:this}),this.orderDetail.init({pageObj:this}),this.orderDetailProductMsg.init({pageObj:this}),this.orderDetailBasicInfo.init({pageObj:this}),this.orderDetailReceiverMsg.init({pageObj:this}),this.orderDetailFinanceMsg.init({pageObj:this}),this.orderDetailOperationLog.init({pageObj:this}),this.orderDetailReturnInfo.init({pageObj:this}),this.orderDetailReturnLog.init({pageObj:this}),this.orderDetailPurchaseLog.init({pageObj:this}),this.orderDetailDepotMsg.init({pageObj:this}),this.orderDetailInvoiceMsg.init({pageObj:this})}},orders.init()},{"../common/current-user-info.js":2,"../common/order-filters-config.js":3,"../orders/modules/order-data-grid.js":4,"../orders/modules/order-detail-basic-info.js":5,"../orders/modules/order-detail-depot-msg.js":6,"../orders/modules/order-detail-finance-msg.js":7,"../orders/modules/order-detail-invoice-msg.js":8,"../orders/modules/order-detail-operation-log.js":9,"../orders/modules/order-detail-product-msg.js":10,"../orders/modules/order-detail-purchase-log.js":11,"../orders/modules/order-detail-receiver-msg.js":12,"../orders/modules/order-detail-return-info.js":13,"../orders/modules/order-detail-return-log.js":14,"../orders/modules/order-detail.js":15,"../orders/modules/order-operations-cancel.js":16,"../orders/modules/order-operations-check-revert.js":17,"../orders/modules/order-operations-check.js":18,"../orders/modules/order-operations-config.js":19,"../orders/modules/order-operations-cut.js":20,"../orders/modules/order-operations-lock-unlock.js":21,"../orders/modules/order-operations-mark.js":22,"../orders/modules/order-operations-merge.js":23,"../orders/modules/order-operations-pause-restart.js":24,"../orders/modules/order-operations-separate.js":25,"../orders/modules/order-operations.js":26,"../orders/modules/order-search.js":27,"../orders/modules/order-tab-filter.js":28,"../utils/format-date-time.js":29,"../utils/loading.js":30}],2:[function(e,t,r){"use strict";var a=function(){this.pageObj=null,this.callBack=null,this.info={},this.init=function(e){this.pageObj=e.pageObj,this.callBack=e.callBack,this.getCurrentUserInfo()},this.getCurrentToken=function(){var e;if("dev"===SYS_VARS.CURRENT_MODE||"debug"===SYS_VARS.CURRENT_MODE){var t=window.location.search.match(/token=(.[^&]+)/g);e=t&&t.length>0?t[0].replace("token=",""):""}else e=H.Cookie.get("userToken");return e&&""!==e&&"null"!==e&&"undefined"!==e?e:(H.alert("获取用户令牌失败，请退出登录后重新登录。"),"")},this.getCurrentUserInfo=function(){var e,t,r=this;t="../src/data/current-user-info.json",e=SYS_VARS.INTERFACE_OFC_URL+"ofc/api/login_info.json/",e=this.pageObj.needMockData?t:e,$.ajax({url:e,method:"GET",type:"json",timeout:1e4,data:{token:this.getCurrentToken()},success:function(e){r.handleGetCurrentUserInfoSuccess(e)},error:function(){}})},this.handleGetCurrentUserInfoSuccess=function(e){(0===e.code||"0"===e.code)&&e.data&&""!==e.data?("string"===(typeof e.data).toLowerCase()?this.info=JSON.parse(e.data):this.info=e.data,this.callBack&&this.callBack()):this.handleError("获取用户信息失败，请退出登录后重新登录。",4e3)},this.handleError=function(e,t){H.alert(e,t||2e3)}};t.exports=new a},{}],3:[function(e,t,r){var a={STORE_NAME:[{key:"-1",value:"-1",label:"选择销售店铺"},{key:"1",value:"1",label:"天猫"},{key:"2",value:"2",label:"京东"},{key:3,value:3,label:"亚马逊"}],ORDER_STATUS:[{key:"-1",value:"-1",label:"选择订单状态"},{key:"1",value:"1",label:"新订单"},{key:"11",value:"11",label:"15min暂停中"},{key:"2",value:"2",label:"客审完成"},{key:"3",value:"3",label:"已下发WMS"},{key:"4",value:"4",label:"等待打包"},{key:"5",value:"5",label:"已发货"},{key:"6",value:"6",label:"已签收"},{key:"7",value:"7",label:"订单完成"},{key:"8",value:"8",label:"已取消"},{key:"9",value:"9",label:"已转病单"},{key:"10",value:"10",label:"已作废"}],OPERATION_ITEMS:[{key:"-1",value:"-1",label:"选择操作项"},{key:"1",value:"1",label:"待锁定"},{key:"2",value:"2",label:"待客审"},{key:"3",value:"3",label:"反客审"},{key:"4",value:"4",label:"已取消"},{key:"5",value:"5",label:"已暂停"},{key:"6",value:"6",label:"已加急"}]};t.exports=a},{}],4:[function(e,t,r){"use strict";var a=function(){this.pageObj,this.selectedOrderCode="",this.selectedOrder={},this.selectedOrderList=[],this.param={},this.defaultConfig={url:"",datatype:"json",mtype:"POST",contentType:"application/json",colNames:["订单编号","下单时间","支付方式","销售店铺","买家留言","卖家备注","物流公司","订单标签","订单状态码","订单状态","是否锁定判断","是否锁定","锁定人id","是否有处方药","应付金额","实付金额","用户名","用户电话","收货人","收货人电话","商品数量","收货地址"],colModel:[{name:"order_id",index:"order_id",sortable:!0,sortorder:"desc",width:200},{name:"order_time",index:"order_time",sortable:!0},{name:"payment_type_tag",index:"payment_type_tag",sortable:!0},{name:"shop_name",index:"shop_name",sortable:!0},{name:"user_remark",index:"user_remark",sortable:!1},{name:"vender_remark",index:"vender_remark",sortable:!1},{name:"company_name",index:"company_name",sortable:!1},{name:"order_tags",align:"center",sortable:!1},{name:"order_status",index:"order_status",sortable:!1},{name:"order_status_name",index:"order_status_name",sortable:!0},{name:"is_lock",index:"is_lock",sortable:!1},{name:"lock_tag",index:"lock_tag",sortable:!0},{name:"locker_cs_id",index:"locker_cs_id",sortable:!0},{name:"rx_tag",index:"rx_tag",align:"center",sortable:!0},{name:"total",index:"total",align:"right",sortable:!0},{name:"paid_amount",index:"paid_amount",align:"right",sortable:!0},{name:"user_name",index:"user_name",sortable:!0},{name:"CustomerPhone",index:"CustomerPhone",sortable:!0},{name:"consignee_name",index:"consignee_name",sortable:!1},{name:"consignee_phone",index:"consignee_phone",sortable:!0},{name:"order_quantity",index:"order_quantity",align:"center",sortable:!0},{name:"address",index:"address",sortable:!1}],rowNum:10,rowList:[10,20,30],pager:"#grid-pager",viewrecords:!0,multiselect:!0,width:$(".page-content").innerWidth()-32,height:"auto",responsive:!0},this.init=function(e){this.pageObj=e.pageObj,this.param.needMockData=e.needMockData,this.setGridConfig(e.needMockData),this.initDataGrid(e.needMockData)},this.setGridConfig=function(e){var t=this.defaultConfig;e!==!0&&(t.jsonReader={root:"rows",page:"page",total:"total",records:"records",repeatitems:!1}),t.loadError=this.setNewCssForGrid.bind(this),t.formatData=this.formatDateTime.bind(this),t.loadComplete=this.loadCompleteForGrid.bind(this),t.gridComplete=this.setNewCssForGrid.bind(this),t.onCellSelect=this.handleCellClick.bind(this),t.onSelectRow=this.handleSelectRow.bind(this),t.onSelectAll=this.handleSelectAll.bind(this)},this.initDataGrid=function(e){var t,r,a=this.defaultConfig;t="http://"+window.location.host+"/ofc_admin_order_front_end/src/data/jqgrid.json?q=2",r=SYS_VARS.INTERFACE_URL+"order_apiv1/orders/list.json",e===!0?a.url=t:(a.url=r,a.postData=this.pageObj.orderSearch.searchParams),this.pageObj.loadingBox.show(),jQuery("#jqgrid").jqGrid(a)},this.refreshDataGrid=function(e){var t,r=this;t=e||r.pageObj.orderSearch.searchParams,$("#jqgrid").jqGrid("setGridParam",{postData:t,page:1}).trigger("reloadGrid"),r.selectedOrderCode="",r.selectedOrder={},r.selectedOrderList=[],r.pageObj.orderDetail.clearDetailInfoPanel(),r.pageObj.orderOperations.clearOperationButtonStatus(),r.pageObj.loadingBox.show()},this.loadCompleteForGrid=function(e){this.pageObj.loadingBox.hide()},this.formatDateTime=function(e){var t=e?e.rows:[],r=this;return t.map(function(e){e.order_time=r.pageObj.formatDateTime.doFormat(e.order_time)}),e},this.setNewCssForGrid=function(){$(".ui-icon.ui-icon-seek-prev").wrap('<div class="btn btn-sm btn-default"></div>'),$(".ui-icon.ui-icon-seek-prev").removeClass().addClass("fa fa-backward"),$(".ui-icon.ui-icon-seek-first").wrap('<div class="btn btn-sm btn-default"></div>'),$(".ui-icon.ui-icon-seek-first").removeClass().addClass("fa fa-fast-backward"),$(".ui-icon.ui-icon-seek-next").wrap('<div class="btn btn-sm btn-default"></div>'),$(".ui-icon.ui-icon-seek-next").removeClass().addClass("fa fa-forward"),$(".ui-icon.ui-icon-seek-end").wrap('<div class="btn btn-sm btn-default"></div>'),$(".ui-icon.ui-icon-seek-end").removeClass().addClass("fa fa-fast-forward")},this.handleCellClick=function(e,t,r,a){1===t&&this.selectedOrderCode!==r&&(this.selectedOrderCode=r,this.selectedOrder=jQuery("#jqgrid").jqGrid("getRowData",e),this.pageObj.orderDetail.showOrHideEditButton(),this.pageObj.orderDetail.getOrderDetail(),$("#jqgrid>tbody>tr").removeClass("highlight"),$("#jqgrid #"+e).addClass("highlight"))},this.handleSelectRow=function(e,t){this.getAllSelectedRows(e,t)},this.handleSelectAll=function(){this.getAllSelectedRows()},this.getAllSelectedRows=function(){var e,t=$("#jqgrid tbody").find('input[type="checkbox"]:checked'),r=this;r.selectedOrderList=[],t.each(function(){e=$(this).attr("name").replace("jqg_jqgrid_",""),r.selectedOrderList.push(jQuery("#jqgrid").jqGrid("getRowData",e))}),this.pageObj.orderOperations.resetOptionsStatus(this.selectedOrderList)}};t.exports=new a},{}],5:[function(e,t,r){"use strict";var a={pageObj:null,renderData:null,init:function(e){var t=this;t.pageObj=e.pageObj},renderBaseMsg:function(e){var t=this;if("undefined"!=typeof e&&(t.renderData=e),t.renderData){var r=H.template($("#J-base-msg-tpl").html(),t.renderData);$("#J-base-msg-wrap").html(r)}},setEditStatus:function(){$("#J-base-msg-wrap").find("table").addClass("cm-table-edit")},setSimpleStatus:function(){$("#J-base-msg-wrap").find("table").removeClass("cm-table-edit"),this.renderBaseMsg()},getSubmitParams:function(){var e={};return $("#J-base-msg-wrap").find("input").each(function(t,r){var a=$(this);e[a.attr("name")]=a.val()}),e}};t.exports=a},{}],6:[function(e,t,r){"use strict";var a={pageObj:null,renderData:null,init:function(e){var t=this;t.pageObj=e.pageObj},renderDepotMsg:function(e){var t=this;if("undefined"!=typeof e&&(t.renderData=e),t.renderData){var r=H.template($("#J-depot-msg-tpl").html(),t.renderData);$("#J-depot-msg-wrap").html(r)}},setEditStatus:function(){$("#J-depot-msg-wrap").find("table").addClass("cm-table-edit")},setSimpleStatus:function(){$("#J-depot-msg-wrap").find("table").removeClass("cm-table-edit"),this.renderDepotMsg()},getSubmitParams:function(){var e={};return $("#J-depot-msg-wrap").find("input").each(function(t,r){var a=$(this);e[a.attr("name")]=a.val()}),e}};t.exports=a},{}],7:[function(e,t,r){"use strict";var a={pageObj:null,renderData:null,init:function(e){var t=this;t.pageObj=e.pageObj,t.addEvent()},renderFinanceMsg:function(e){var t=this;if("undefined"!=typeof e&&(t.renderData=e),t.renderData){var r=H.template($("#J-finance-msg-tpl").html(),t.renderData);$("#J-finance-msg-wrap").html(r)}},setEditStatus:function(){$("#J-finance-msg-wrap").find("table").addClass("cm-table-edit")},setSimpleStatus:function(){$("#J-finance-msg-wrap").find("table").removeClass("cm-table-edit"),this.renderFinanceMsg()},getSubmitParams:function(){var e={};return $("#J-finance-msg-wrap").find("input").each(function(t,r){var a=$(this);e[a.attr("name")]=a.val()}),e},addEvent:function(){var e="[name=cs_coupon], [name=cash_coupon], [name=gift_coupon], [name=delivery_amount]";$(document).on("keyup",e,function(){var e=$(this);e.parent().siblings(".status-simple").text(e.val());var t=$("#goods_amount"),r=$("#order_total"),a=$("#paid_amount"),i=$("#unpaid_amount"),o=$("#cs_coupon"),n=$("#cash_coupon"),s=$("#gift_coupon"),d=$("#delivery_amount"),c=parseFloat(t.text())+parseFloat(o.find("input").val())+parseFloat(n.find("input").val())+parseFloat(s.find("input").val())+parseFloat(d.find("input").val());r.text(isNaN(c)?0:c);var l=c-parseFloat(a.text());i.find("input").val(isNaN(l)?0:l)})}};t.exports=a},{}],8:[function(e,t,r){"use strict";var a={pageObj:null,renderData:null,init:function(e){var t=this;t.pageObj=e.pageObj,t.bindEvents()},renderInvoiceMsg:function(e){var t=this;if("undefined"!=typeof e&&(t.renderData=e),t.renderData){var r=H.template($("#J-invoice-list-tpl").html(),{list:t.renderData});$("#J-invoice-list-wrap").html(r)}},insertInvoice:function(e){var t=H.template($("#J-invoice-list-opt-tpl").html(),{index:e});$("#J-invoice-list-body").append(t)},setEditStatus:function(){$("#J-invoice-list-wrap").find("table").addClass("cm-table-edit"),$("#J-invoice-btn-wrap").show(),this.setClickPop(1)},setSimpleStatus:function(){$("#J-invoice-list-wrap").find("table").removeClass("cm-table-edit"),$("#J-invoice-btn-wrap").hide(),this.renderInvoiceMsg(),this.setClickPop(0)},setClickPop:function(e){function t(t){t.click(function(){if(0===e)return!1;var t=$(this),r=t.parent().index(),i=a[r].invoice_content;if(i.length>0){var o='<table class="cm-table">';o+="<tr><th>商品</th><th>单位</th><th>商品数量</th><th>商品单价</th></tr>";for(var n in i)o+="<tr>",o+="<td>"+i[n].content+"</td>",o+="<td>"+i[n].unit+"</td>",o+="<td>"+i[n].quantity+"</td>",o+="<td>"+i[n].price+"</td>",o+="</tr>";o+="</table>";var s=H.dialog({title:"发票内容",content:o,quickClose:!0,padding:5,width:400,backdropOpacity:.7,onshow:function(){},onclose:function(){}});s.show()}})}for(var r=this,a=r.renderData,i=$("tbody#J-invoice-list-body > tr"),o=0;o<i.length;o++){var n=i.eq(o).find("td:eq(4)");0===e?n.find("p").removeAttr("style"):(n.find("p").css({color:"#4591cf",cursor:"pointer"}),""!==$.trim(n.text())&&t(n))}},getSubmitParams:function(){var e=[];return $("#J-invoice-list-body").find("tr").each(function(t,r){var a=$(this);e.push({being_deleted_invoice:a.find("input[name=being_deleted_invoice]").val(),invoice_id:a.find("input[name=invoice_id]").val(),invoice_type:a.find("select[name=invoice_type]").val(),invoice_title:a.find("input[name=invoice_title]").val(),invoice_money:a.find("input[name=invoice_money]").val(),actual_invoice_content:a.find("input[name=actual_invoice_content]").val(),actual_invoice_money:a.find("input[name=actual_invoice_money]").val()})}),e},bindEvents:function(){var e=this;$("#J-invoice-list-add").on("click",function(){e.insertInvoice($("#J-invoice-list-body").find("tr").length)}),$("#J-invoice-list-del").on("click",function(){$("#J-invoice-list-body").find("input[type=checkbox]:checked").each(function(){var e=$(this).closest("tr");""==e.find("input[name=invoice_id]").val()?e.remove():e.hide().find("input[name=being_deleted_invoice]").val(1)})})}};t.exports=a},{}],9:[function(e,t,r){"use strict";var a={pageObj:null,dataHasLoaded:!1,pagination:null,pageInfo:{pageNo:1,pageSize:20,tabId:1},init:function(e){var t=this;t.pageObj=e.pageObj,t.pagination=new H.Pager({tplB:$("#J-pager-tpl").html(),wrapB:$("#J-pager-wrap-operation"),goToPageFunc:function(e){t.pageInfo.pageNo=e,t.renderLogMsg(e)}})},renderLogMsg:function(e){var t,r,a,i,o;if(this.dataHasLoaded!==!0){if(r=this.pageObj.orderDataGrid.selectedOrderCode||"",a=e||this.pageInfo.pageNo,i=this.pageInfo.pageSize,o=this.pageInfo.tabId,""===r)return alert("无订单编号，请重试"),!1;t=this.pageObj.orderDataGrid.param.needMockData===!0?"../src/data/operation-info.json?order_code="+r+"&page="+a+"&page_size="+i+"&tab_id="+o:SYS_VARS.INTERFACE_URL+"order_apiv1/order/logs/"+r+".json?page="+a+"&page_size="+i+"&tab_id="+o,$.ajax({url:t,type:"GET",dataType:"json",success:this.getOrderOperationSuccess.bind(this),error:this.getOrderOperationFailed.bind(this)})}},getOrderOperationSuccess:function(e){200===e.code||"200"===e.code?(this.dataHasLoaded=!0,this.buildHTML(e.rows),this.setPage(e)):this.getOrderOperationFailed(e)},buildHTML:function(e){var t=H.template($("#J-operation-log-tpl").html(),{list:e});$("#J-operation-log-wrap").html(t)},setPage:function(e){this.pagination.render({pg:e.page,total:e.records,ps:this.pageInfo.pageSize})},getOrderOperationFailed:function(e){var t=e&&e.msg?e.msg:"获取操作日志失败";alert(t)}};t.exports=a},{}],10:[function(e,t,r){"use strict";var a={pageObj:null,popObj:null,pagerObj:null,renderData:null,init:function(e){var t=this;t.pageObj=e.pageObj,t.bindEvents()},setEditStatus:function(){$("#J-pro-list-wrap").find("table").addClass("cm-table-edit"),$("#J-pro-btn-wrap").show()},setSimpleStatus:function(){$("#J-pro-list-wrap").find("table").removeClass("cm-table-edit"),$("#J-pro-btn-wrap").hide(),this.renderProductList()},renderProductList:function(e){var t=this;if("undefined"!=typeof e&&(t.renderData=e),t.renderData){var r=H.template($("#J-pro-list-tpl").html(),{list:t.renderData});$("#J-pro-list-wrap").html(r)}},searchProduct:function(e){var t=this;if(e.goods_name_or_sku=$("#J-pro-add-pop-btn-key-word").val(),SYS_VARS.NEED_MOCK_DATA)var r="../src/data/goods-search.json";else var r=SYS_VARS.INTERFACE_URL+"order_apiv1/order/goods_search.json";$.ajax({url:r,method:"post",type:"json",timeout:1e4,data:JSON.stringify(e),success:function(e){t.renderDataCache=e.data;var r=H.template($("#J-pro-search-list-tpl").html(),e);$("#J-pro-add-pop-search-list-wrap").html(r),e.records>0?(null==t.pagerObj&&(t.pagerObj=new H.Pager({tplB:$("#J-pager-tpl").html(),wrapB:$("#J-pro-add-pop-pager-wrap"),goToPageFunc:function(e){t.searchProduct({currentPage:e,pageSize:5})}})),t.pagerObj.render({pg:e.page,total:e.records,ps:5})):$("#J-pro-add-pop-pager-wrap").html("")},error:function(){H.alert("商品搜索失败，请稍后重试。")}})},addProduct:function(){var e=this.renderData,t=this.renderDataCache,r=$("#J-pro-search-list").find("input[type=checkbox]:checked").parent().parent();if(r.length>0){for(var a=0;a<r.length;a++){var i=r.eq(a).find("td").eq(1).text();for(var o in t){var n=t[o],s=n.goods_sku_id;i==s&&(n.quantity=r.eq(a).find("input[name=quantity]").val(),this.injectData(n,this.checkSku(i,e),e))}}var d=H.template($("#J-pro-list-tpl").html(),{list:this.renderData});$("#J-pro-list-wrap").html(d).find("table.cm-table").addClass("cm-table-edit").find("input[name=being_deleted_goods][value=1]").parents("tr").hide(),$("#J-pro-add-pop-btn-cancel").trigger("click")}else H.alert("没有选中任何商品")},injectData:function(e,t,r){var a={},i=!1;t&&(a=r[t],i=!0);var o={being_deleted_goods:2===a.being_deleted_goods?2:i?0:2,sku_id:e.goods_sku_id,goods_name:e.goods_name,goods_spec:a.goods_spec||"",goods_remark:a.goods_remark||"",warehouse_status:e.goods_number,is_rx:e.is_rx,total_money:parseFloat(e.goods_price)+parseFloat(a.goods_price||0),order_quantity:parseFloat(e.quantity)+parseFloat(a.order_quantity||0),discount:a.discount||10,shipment_batch_num:a.shipment_batch_num||"",production_date:a.production_date||"",expiry_date:a.expiry_date||"",send_num:a.send_num||""};i?r[t]=o:r.push(o)},checkSku:function(e,t){for(var r in t)if(e==t[r].sku_id)return r;return!1},getSubmitParams:function(){var e=[];return $("#J-pro-list-body").find("tr").each(function(t,r){var a=$(this);e.push({being_deleted_goods:a.find("input[name=being_deleted_goods]").val(),sku_id:a.find("input[name=sku_id]").val(),good_remark:a.find("input[name=good_remark]").val(),quantity:a.find("input[name=quantity]").val()})}),e},bindEvents:function(){var e=this;$(document).on("change","#J-pro-list-wrap .J-check-all",function(){var e=this.checked;$("#J-pro-list-body").find("input[type=checkbox]").each(function(){$(this).prop("checked",e)})}).on("change","#J-pro-list-body input[type=checkbox]",function(){$("#J-pro-list-body").find("input[type=checkbox]").length==$("#J-pro-list-body").find("input[type=checkbox]:checked").length?$("#J-pro-list-wrap").find(".J-check-all").prop("checked",!0):$("#J-pro-list-wrap").find(".J-check-all").prop("checked",!1)}).on("click","#J-pro-add-pop-btn-cancel",function(){e.popObj.remove()}).on("click","#J-pro-add-pop-btn-add",function(){e.addProduct()}).on("click","#J-pro-add-pop-btn-search",function(){e.searchProduct({currentPage:1,pageSize:5})}),$("#J-pro-list-add").on("click",function(){var t=$(this);e.popObj=H.dialog({title:"新增商品",content:$("#J-pro-add-pop-tpl").html(),quickClose:!0,padding:10,backdropOpacity:.3,width:880,onshow:function(){if("edit"==t.data("type")){var e=$("#J-pop-form"),r=t.closest("p.J-menu-item");e.find("input[name=id]").val(t.data("id")),e.find("input[name=name]").val(r.find(".J-menu-name").text()),e.find("input[name=href]").val(r.find(".J-menu-href").text())}else $("#J-pop-form").find("input[name=pid]").val(t.data("pid")||0)},onremove:function(){e.pagerObj=null}}).show()}),$("#J-pro-list-del").on("click",function(){$("#J-pro-list-body").find("input[type=checkbox]:checked").each(function(){var t=$(this).closest("tr");if(t.hasClass("J-default")){t.hide().find("input[name=being_deleted_goods]").val(1);var r=t.find("td").eq(2).text(),a=e.renderData;for(var i in a)r==a[i].sku_id&&(a[i].being_deleted_goods=1)}else t.remove()})}),$(document).on("keyup",'input[name="order_quantity"]',function(){var t,r,a,i=$(this);t=i.parents("tr"),r=t.find("td:eq(8)"),a=t.find("td:eq(10)");var o=parseFloat(r.text())*parseFloat(i.val());a.text(o.toFixed(2)),e.syncFinance()})},syncFinance:function(){for(var e=$("#J-pro-list-body").find("tr"),t=$("#J-finance-msg"),r=0,a=0;a<e.length;a++)r+=parseFloat(e.eq(a).find("td:eq(10)").text());t.find("#goods_amount").text(r),$("[name=delivery_amount]").trigger("keyup")}};t.exports=a},{}],11:[function(e,t,r){"use strict";var a={pageObj:null,dataHasLoaded:!1,pagination:null,pageInfo:{pageNo:1,pageSize:20,tabId:4},init:function(e){var t=this;t.pageObj=e.pageObj,t.pagination=new H.Pager({tplB:$("#J-pager-tpl").html(),wrapB:$("#J-pager-wrap-purchase"),goToPageFunc:function(e){t.pageInfo.pageNo=e,t.doAjaxToLoadData(e)}})},renderLogMsg:function(){this.dataHasLoaded!==!0&&this.doAjaxToLoadData()},doAjaxToLoadData:function(e){var t,r,a,i,o;return r=this.pageObj.orderDataGrid.selectedOrderCode||"",a=e||this.pageInfo.pageNo,i=this.pageInfo.pageSize,o=this.pageInfo.tabId,""===r?(alert("无订单编号，请重试"),!1):(t=this.pageObj.orderDataGrid.param.needMockData===!0?"../src/data/purchase-log.json?order_code="+r+"&page="+a+"&page_size="+i+"&tab_id="+o:SYS_VARS.INTERFACE_URL+"order_apiv1/order/logs/"+r+".json?page="+a+"&page_size="+i+"&tab_id="+o,void $.ajax({url:t,type:"GET",dataType:"json",success:this.getOrderPurchaseSuccess.bind(this),error:this.getOrderPurchaseFailed.bind(this)}))},getOrderPurchaseSuccess:function(e){200===e.code||"200"===e.code?(this.dataHasLoaded=!0,this.buildHTML(e.rows),this.setPage(e)):this.getOrderPurchaseFailed(e)},buildHTML:function(e){var t=H.template($("#J-purchase-log-tpl").html(),{list:e});$("#J-purchase-log-wrap").html(t)},setPage:function(e){this.pagination.render({pg:e.page,total:e.records,ps:this.pageInfo.pageSize})},getOrderPurchaseFailed:function(e){var t=e&&e.msg?e.msg:"获取操作日志失败";alert(t)}};t.exports=a},{}],12:[function(e,t,r){"use strict";var a={pageObj:null,renderData:null,init:function(e){var t=this;t.pageObj=e.pageObj},renderReceiverMsg:function(e){var t=this;if("undefined"!=typeof e&&(t.renderData=e),t.renderData){t.renderData.province_name=t.renderData.region_name||"",t.renderData.city_name=t.renderData.region_name||"",t.renderData.district_name=t.renderData.region_name||"";var r=H.template($("#J-receiver-msg-tpl").html(),t.renderData);$("#J-receiver-msg-wrap").html(r)}},setEditStatus:function(){$("#J-receiver-msg-wrap").find("table").addClass("cm-table-edit"),this.getAreaData()},setSimpleStatus:function(){$("#J-receiver-msg-wrap").find("table").removeClass("cm-table-edit"),this.renderReceiverMsg()},getSubmitParams:function(){var e={},t=$("#J-receiver-msg-wrap").find("input"),r=$("#J-receiver-msg-wrap").find("select");return t.find("input").each(function(){var t=$(this);e[t.attr("name")]=t.val()}),r.find("select").each(function(){var t=$(this);e[t.attr("name")]=t.val()}),e},getAreaData:function(){if(SYS_VARS.NEED_MOCK_DATA)var e="../src/data/address.json";else var e=SYS_VARS.INTERFACE_URL+"order_apiv1/order/address.json";var t,r=$("#J-receiver-msg-province"),a=$("#J-receiver-msg-city"),i=$("#J-receiver-msg-district"),o=function(e){t=[],$.each(e,function(e,r){r.id&&r.region_name&&t.push('<option value="'+r.id+'">'+r.region_name+"</option>")}),r.append(t.join(""))},n=function(e){t=["<option>请选择城市</option>"],e&&e.length>0&&$.each(e,function(e,r){r.id&&r.region_name&&t.push('<option value="'+r.id+'">'+r.region_name+"</option>")}),a.html(t)},s=function(e){t="<option>请选择区县</option>","undefined"==typeof e||""===e?i.css("display","none"):(i.css("display","inline"),$.each(e,function(e,r){r.id&&r.region_name&&(t+='<option value="'+r.id+'">'+r.region_name+"</option>")}),i.html(t))};r.change(function(){var t=parseInt(r.val()||0,10),a={province:t},o=JSON.stringify(a);$.ajax({type:"post",dataType:"json",url:e,data:o,success:function(e){n(e),i.html("<option>请选择区县</option>")},error:function(){console.log("Bad Lucky! Something went wrong.")}})}),a.change(function(){var t=parseInt(r.val()||0,10),i=parseInt(a.val()||0,10),o={province:t,city:i},n=JSON.stringify(o);$.ajax({type:"post",dataType:"json",url:e,data:n,success:function(e){s(e)},error:function(){console.log("Bad Lucky! Something went wrong.")}})}),$.ajax({type:"post",dataType:"json",url:e,success:function(e){o(e)},error:function(){console.log("Bad Lucky! Something went wrong.")}})}};t.exports=a},{}],13:[function(e,t,r){"use strict";var a={pageObj:null,dataHasLoaded:!1,pagination:null,pageInfo:{pageNo:1,pageSize:20,tabId:3},init:function(e){var t=this;t.pageObj=e.pageObj,t.pagination=new H.Pager({tplB:$("#J-pager-tpl").html(),wrapB:$("#J-pager-wrap-return-info"),goToPageFunc:function(e){t.pageInfo.pageNo=e,t.renderLogMsg(e)}})},renderLogMsg:function(e){var t,r,a,i,o;if(this.dataHasLoaded!==!0){if(r=this.pageObj.orderDataGrid.selectedOrderCode||"",a=e||this.pageInfo.pageNo,i=this.pageInfo.pageSize,o=this.pageInfo.tabId,""===r)return alert("无订单编号，请重试"),!1;t=this.pageObj.orderDataGrid.param.needMockData===!0?"../src/data/return-info.json?order_code="+r+"&page="+a+"&page_size="+i+"&tab_id="+o:SYS_VARS.INTERFACE_URL+"order_apiv1/order/logs/"+r+".json?page="+a+"&page_size="+i+"&tab_id="+o,$.ajax({url:t,type:"GET",dataType:"json",success:this.getOrderReturnSuccess.bind(this),error:this.getOrderReturnFailed.bind(this)})}},getOrderReturnSuccess:function(e){200===e.code||"200"===e.code?(this.dataHasLoaded=!0,this.buildHTML(e.rows),this.setPage(e)):this.getOrderReturnFailed(e)},buildHTML:function(e){var t=H.template($("#J-return-info-tpl").html(),{list:e[0]});$("#J-return-info-wrap").html(t)},setPage:function(e){this.pagination.render({pg:e.page,total:e.records,ps:this.pageInfo.pageSize})},getOrderReturnFailed:function(e){var t=e&&e.msg?e.msg:"获取操作日志失败";alert(t)}};t.exports=a},{}],14:[function(e,t,r){"use strict";var a={pageObj:null,dataHasLoaded:!1,pagination:null,pageInfo:{pageNo:1,pageSize:20,tabId:2},init:function(e){var t=this;t.pageObj=e.pageObj,t.pagination=new H.Pager({tplB:$("#J-pager-tpl").html(),wrapB:$("#J-pager-wrap-return"),goToPageFunc:function(e){t.pageInfo.pageNo=e,t.renderLogMsg(e)}})},renderLogMsg:function(e){var t,r,a,i,o;if(this.dataHasLoaded!==!0){if(r=this.pageObj.orderDataGrid.selectedOrderCode||"",a=e||this.pageInfo.pageNo,i=this.pageInfo.pageSize,o=this.pageInfo.tabId,""===r)return alert("无订单编号，请重试"),!1;t=this.pageObj.orderDataGrid.param.needMockData===!0?"../src/data/return-log.json?order_code="+r+"&page="+a+"&page_size="+i+"&tab_id="+o:SYS_VARS.INTERFACE_URL+"order_apiv1/order/logs/"+r+".json?page="+a+"&page_size="+i+"&tab_id="+o,$.ajax({url:t,type:"GET",dataType:"json",success:this.getOrderReturnSuccess.bind(this),error:this.getOrderReturnFailed.bind(this)})}},getOrderReturnSuccess:function(e){200===e.code||"200"===e.code?(this.dataHasLoaded=!0,this.buildHTML(e.rows),this.setPage(e)):this.getOrderReturnFailed(e)},buildHTML:function(e){var t=H.template($("#J-return-log-tpl").html(),{list:e});$("#J-return-log-wrap").html(t)},setPage:function(e){this.pagination.render({pg:e.page,total:e.records,ps:this.pageInfo.pageSize})},getOrderReturnFailed:function(e){var t=e&&e.msg?e.msg:"获取操作日志失败";alert(t)}};t.exports=a},{}],15:[function(e,t,r){"use strict";var a={pageObj:null,currentTabIndex:0,init:function(e){var t=this;t.pageObj=e.pageObj,t.setTab(t.pageObj),t.bindEvents(t.pageObj)},setTab:function(e){$("#J-detail-tab").find("li").on("click",function(){var t=$(this);e.orderDetail.currentTabIndex=t.index(),e.orderDetail.loadDetailLogInfo(e.orderDetail.currentTabIndex),e.orderDetail.showOrHideEditButton(),t.addClass("active").siblings().removeClass("active"),$("#J-detail-cont > div.J-detail-cont-inner").eq(t.index()).show().siblings().hide()})},renderDetail:function(e){var t=this;t.resetAllTabLoadedFlag(),t.currentTabIndex>=6?t.loadDetailLogInfo(t.currentTabIndex):(t.pageObj.orderDetailBasicInfo.renderBaseMsg(e.order_info),t.pageObj.orderDetailProductMsg.renderProductList(e.order_goods),t.pageObj.orderDetailReceiverMsg.renderReceiverMsg(e.order_consignee),t.pageObj.orderDetailFinanceMsg.renderFinanceMsg(e.order_finance),t.pageObj.orderDetailInvoiceMsg.renderInvoiceMsg(e.order_invoice),t.pageObj.orderDetailDepotMsg.renderDepotMsg(e.order_stock)),$("#J-detail-cont-wrap").show()},getOrderDetail:function(){var e,t,r;return t=this.pageObj.orderDataGrid.selectedOrderCode,r=this.pageObj.orderCurrentUser.getCurrentToken(),r&&""!==r?(e=this.pageObj.needMockData===!0?"../src/data/order-detail.json?order_id="+t:SYS_VARS.INTERFACE_URL+"order_apiv1/orders/list.json?order_id="+t,
this.pageObj.loadingBox.show(),void $.ajax({url:e,type:"GET",dataType:"json",success:this.getOrderDetailSuccess.bind(this),error:this.getOrderDetailFailed.bind(this)})):(H.alert("获取用户令牌失败，请退出登录后重新登录。"),!1)},getOrderDetailSuccess:function(e){200===e.code||"200"===e.code?(this.pageObj.loadingBox.hide(),e.data?(this.formatData(e.data),this.renderDetail(e.data)):this.getOrderDetailFailed()):this.getOrderDetailFailed()},formatData:function(e){return this.pageObj.formatDateTime&&(e.order_info.order_time=this.pageObj.formatDateTime.doFormat(e.order_info.order_time),e.order_info.order_finish_time=this.pageObj.formatDateTime.doFormat(e.order_info.order_finish_time)),e},getOrderDetailFailed:function(){this.pageObj.loadingBox.hide(),H.alert("获取订单详情失败"),this.clearDetailInfoPanel()},clearDetailInfoPanel:function(){$("#J-detail-cont-wrap").hide()},showOrHideEditButton:function(){var e,t,r=this.pageObj.orderCurrentUser.info;e=r.userId===parseInt(this.pageObj.orderDataGrid.selectedOrder.locker_cs_id||0,10),t=parseInt(this.pageObj.orderDataGrid.selectedOrder.order_status,10)<500,e===!0&&t===!0?$("#J-detail-control-but").show():$("#J-detail-control-but").hide()},loadDetailLogInfo:function(e){switch(e){case 6:this.pageObj.orderDetailOperationLog.dataHasLoaded||this.pageObj.orderDetailOperationLog.renderLogMsg();break;case 7:this.pageObj.orderDetailReturnInfo.dataHasLoaded||this.pageObj.orderDetailReturnInfo.renderLogMsg();break;case 8:this.pageObj.orderDetailReturnLog.dataHasLoaded||this.pageObj.orderDetailReturnLog.renderLogMsg();break;case 9:this.pageObj.orderDetailPurchaseLog.dataHasLoaded||this.pageObj.orderDetailPurchaseLog.renderLogMsg()}},resetAllTabLoadedFlag:function(){this.pageObj.orderDetailBasicInfo.dataHasLoaded=!1,this.pageObj.orderDetailProductMsg.dataHasLoaded=!1,this.pageObj.orderDetailReceiverMsg.dataHasLoaded=!1,this.pageObj.orderDetailFinanceMsg.dataHasLoaded=!1,this.pageObj.orderDetailInvoiceMsg.dataHasLoaded=!1,this.pageObj.orderDetailDepotMsg.dataHasLoaded=!1,this.pageObj.orderDetailOperationLog.dataHasLoaded=!1,this.pageObj.orderDetailReturnInfo.dataHasLoaded=!1,this.pageObj.orderDetailReturnLog.dataHasLoaded=!1,this.pageObj.orderDetailPurchaseLog.dataHasLoaded=!1},saveDetailMsg:function(){var e,t,r,a,i,o,n,s=this;return e=s.pageObj.orderCurrentUser.getCurrentToken(),e&&""!==e?(t=s.pageObj.orderDetailBasicInfo.getSubmitParams(),r=s.pageObj.orderDetailProductMsg.getSubmitParams(),a=s.pageObj.orderDetailReceiverMsg.getSubmitParams(),i=s.pageObj.orderDetailFinanceMsg.getSubmitParams(),o=s.pageObj.orderDetailInvoiceMsg.getSubmitParams(),n=s.pageObj.orderDetailDepotMsg.getSubmitParams(),void $.ajax({url:SYS_VARS.INTERFACE_URL+"order_apiv1/order/edit.json",method:"post",type:"json",timeout:1e4,data:JSON.stringify({order_id:s.pageObj.orderDetailBasicInfo.renderData.order_id,order_info:t,order_goods:r,order_consignee:a,order_finance:i,order_invoice:o,order_stock:n}),success:function(e){var t="";if("-1"===e.code||-1===e.code)t+=e.msg;else{var r=["info","goods","consignee","finance","invoice"];for(var a in r)void 0!==e["order_"+r[a]+"_msg"]&&(t+=0==e["order_"+r[a]+"_code"]?"<p>"+e["order_"+r[a]+"_msg"]+"</p>":'<p class="red">order_'+r[a]+"_msg保存出错!</p>")}H.alert(t),s.pageObj.orderDataGrid.getOrderDetail(),s.setBtnFolkStatus(),s.setStatusAddToModify(s.pageObj.orderDetailInvoiceMsg.renderData)},error:function(){H.alert("保存产品详情信息接口调用失败")}})):(H.alert("获取用户令牌失败，请退出登录后重新登录。"),!1)},setStatusAddToModify:function(e){console.log(e)},setBtnFolkStatus:function(){$("#J-pro-detail-edit").show(),$("#J-pro-detail-cancel").hide(),$("#J-pro-detail-save").removeClass("cm-btn-blue").addClass("cm-btn-gray"),$("#J-pro-btn-wrap, #J-invoice-btn-wrap").hide()},setModulesToEditStatus:function(){var e=this;e.pageObj.orderDetailBasicInfo.setEditStatus(),e.pageObj.orderDetailProductMsg.setEditStatus(),e.pageObj.orderDetailReceiverMsg.setEditStatus(),e.pageObj.orderDetailFinanceMsg.setEditStatus(),e.pageObj.orderDetailInvoiceMsg.setEditStatus(),e.pageObj.orderDetailDepotMsg.setEditStatus(),$("#J-pro-detail-edit").hide(),$("#J-pro-detail-cancel").show(),$("#J-pro-detail-save").removeClass("cm-btn-gray").addClass("cm-btn-blue").show()},setModulesToSimpleStatus:function(){var e=this;e.pageObj.orderDetailBasicInfo.setSimpleStatus(),e.pageObj.orderDetailProductMsg.setSimpleStatus(),e.pageObj.orderDetailReceiverMsg.setSimpleStatus(),e.pageObj.orderDetailFinanceMsg.setSimpleStatus(),e.pageObj.orderDetailInvoiceMsg.setSimpleStatus(),e.pageObj.orderDetailDepotMsg.setSimpleStatus(),$("#J-pro-detail-edit").show(),$("#J-pro-detail-cancel").hide(),$("#J-pro-detail-save").removeClass("cm-btn-blue").addClass("cm-btn-gray").hide()},bindEvents:function(e){$("#J-pro-detail-edit").on("click",function(){e.orderDetail.setModulesToEditStatus()}),$("#J-pro-detail-cancel").on("click",function(){e.orderDetail.setModulesToSimpleStatus()}),$("#J-pro-detail-save").on("click",function(){return $("#J-pro-detail-edit").is(":visible")?(H.alert("请进入编辑状态后再保存！"),!1):void e.orderDetail.saveDetailMsg()}),$(document).on("click","#J-detail-cont-wrap th input:checkbox",function(){$(this).prop("checked")?$(this).parents("table").find("tbody input:checkbox").prop("checked",!0):$(this).parents("table").find("tbody input:checkbox").prop("checked",!1)})}};t.exports=a},{}],16:[function(e,t,r){"use strict";var a=function(){this.pageObj,this.confirmPop=null,this.goods=null,this.init=function(e){this.pageObj=e.pageObj},this.doConfirm=function(){var e,t=this.pageObj.orderDataGrid.selectedOrderList,r=[],a=[];t.forEach(function(e){r.push(e.order_id)}),e=abNormalOrders?"abNormalOrders":"orders",a.push('<div class="button-row">'),a.push("请确认你要取消的订单：<br/>"+r.join("，<br/>")+"<br/><br/>"),a.push("</div>"),a.push('<div class="button-row">'),a.push('<input type="button" class="btn btn-sm btn-gray" value="取消" onclick="'+e+".orderOperationsCancel.doCancel('"+e+"');\"> "),a.push('<input type="button" class="btn btn-sm btn-primary" value="确认" onclick="'+e+".orderOperationsCancel.doCancelOrder('"+e+"');\">"),a.push("</div>"),this.confirmPop=H.dialog({title:"取消订单确认",content:a.join(""),width:400,quickClose:!0,padding:10,backdropOpacity:.3}).show()},this.doCancelOrder=function(e){var t,r,a,i=this.pageObj.orderDataGrid.selectedOrderList,o=[],n=this;this.confirmPop.remove(),i.forEach(function(e){o.push(e.order_id)}),"abNormalOrders"===e&&(a=1),r="../src/data/do-check-result.json",t=SYS_VARS.INTERFACE_OFC_URL+this.pageObj.orderOperationsConfig["do-cancel"].url,t=this.pageObj.needMockData?r:t,this.pageObj.loadingBox.show(),$.ajax({url:t,method:"POST",type:"json",timeout:1e4,headers:{userToken:n.pageObj.orderCurrentUser.getCurrentToken()},data:JSON.stringify({order_ids:o,isAbnormalOrder:a}),success:function(e){n.pageObj.loadingBox.hide(),n.handleSuccess(e,o)},error:function(){n.pageObj.loadingBox.hide(),H.alert("订单取消失败，请稍后重试")}})},this.doCancel=function(){this.confirmPop.remove()},this.handleSuccess=function(e,t){this.confirmPop.remove(),200===e.code||"200"===e.code?H.alert("订单：<br/>"+t.join("<br/>")+"<br/>取消成功"):this.handleError((e.msg||"")+"订单：<br/>"+e.data.join("<br/>")+"<br/>取消失败，请稍后重试",4e3)},this.changeTabToAll=function(){this.pageObj.orderDataGrid.refreshDataGrid()},this.handleError=function(e,t){H.alert(e,t||2e3)}};t.exports=new a},{}],17:[function(e,t,r){"use strict";var a=function(){this.pageObj,this.confirmPop=null,this.goods=null,this.init=function(e){this.pageObj=e.pageObj},this.doConfirm=function(){var e=this.pageObj.orderDataGrid.selectedOrderList,t=[],r=[];e.forEach(function(e){t.push(e.order_id)}),r.push('<div class="button-row">'),r.push("请确认你要反审核的订单："+t.join("，")+"<br/><br/>"),r.push("</div>"),r.push('<div class="button-row">'),r.push('<input type="button" class="btn btn-sm btn-gray" value="取消" onclick="orders.orderOperationsCheckRevert.doCancel();"> '),r.push('<input type="button" class="btn btn-sm btn-primary" value="确认" onclick="orders.orderOperationsCheckRevert.doCheckRevert();">'),r.push("</div>"),this.confirmPop=H.dialog({title:"反审核订单确认",content:r.join(""),width:400,quickClose:!0,padding:10,backdropOpacity:.3}).show()},this.doCheckRevert=function(){var e,t,r=this.pageObj.orderDataGrid.selectedOrderList,a=this,i=[];r.forEach(function(e){i.push(e.order_id)}),t="../src/data/do-lock-result.json",e=SYS_VARS.INTERFACE_OFC_URL+this.pageObj.orderOperationsConfig["do-check-revert"].url,e=this.pageObj.needMockData?t:e,a.pageObj.loadingBox.show(),$.ajax({url:e,method:"POST",type:"json",timeout:1e4,data:JSON.stringify({order_ids:i}),headers:{userToken:a.pageObj.orderCurrentUser.getCurrentToken()},success:function(e){a.pageObj.loadingBox.hide(),a.handleSuccess(e,i)},error:function(){a.pageObj.loadingBox.hide(),a.handleError("订单反审核失败，请稍后重试",4e3)}})},this.doCancel=function(){this.confirmPop.remove()},this.handleSuccess=function(e,t){this.confirmPop.remove(),200===e.code||"200"===e.code?H.alert("订单：<br/>"+t.join("<br/>")+"<br/>反审核成功"):this.handleError("订单：<br/>"+e.data.join("<br/>")+"<br/>反审核失败，请稍后重试",4e3)},this.changeTabToAll=function(){var e=$("#tabStatusFilter li:eq(0)");this.pageObj.orderTabFilter.toggleTab(e)},this.handleError=function(e,t){H.alert(e,t||2e3)}};t.exports=new a},{}],18:[function(e,t,r){"use strict";var a=function(){this.pageObj,this.init=function(e){this.pageObj=e.pageObj,this.confirmPop,this.manualList=null,this.oldManualList=null,this.count=0},this.doCheckConfirm=function(){var e,t,r=this.pageObj.orderDataGrid.selectedOrderList,a=[],i=this;r.forEach(function(e){a.push(e.order_id)}),t="../src/data/do-check-result.json",e=SYS_VARS.INTERFACE_OFC_URL+this.pageObj.orderOperationsConfig["do-check"].url,e=this.pageObj.needMockData?t:e,this.pageObj.loadingBox.show(),$.ajax({url:e,method:"POST",type:"json",timeout:1e4,headers:{userToken:i.pageObj.orderCurrentUser.getCurrentToken()},data:JSON.stringify({order_ids:a}),success:function(e){i.pageObj.loadingBox.hide(),i.handleCheckSuccess(e)},error:function(){i.pageObj.loadingBox.hide(),H.alert("客审订单失败，请稍后重试")}})},this.handleCheckSuccess=function(e){200===e.code||"200"===e.code?(H.alert("客审订单成功"),this.changeTabToWaitForDelivery()):this.handleCheckFailed(e)},this.changeTabToWaitForDelivery=function(){var e=$("#tabStatusFilter li:eq(3)");this.pageObj.orderTabFilter.toggleTab(e)},this.handleCheckFailed=function(e){var t,r;e.data?(t=e.data.check_failed_orders||[],r=e.data.manual_check_data,r&&r.length>0?(this.manualList=r,this.oldManualList=JSON.stringify(this.manualList),this.oldManualList=JSON.parse(this.oldManualList),this.showManuallyCheckConfirm(r,t)):H.alert("订单：<br/>"+t.join(",</br>")+"</br>审核失败，请重试",4e3)):H.alert(e.msg+"<br/>订单审核失败，请重试",4e3)},this.showManuallyCheckConfirm=function(e,t){var r,a,i,o=this.pageObj.orderDataGrid.selectedOrderList,n=this;e.forEach(function(e,t){e.vender_coupon_html=n.getInputListHtml("vender_coupon",e.vender_coupon,t),e.cash_coupon_html=n.getInputListHtml("cash_coupon",e.cash_coupon,t),e.gift_coupon_html=n.getInputListHtml("gift_coupon",e.gift_coupon,t),e.points_html=n.getPointsHtml("points",e.points)}),i=H.template($("#J-check-order-pop-list-tpl").html(),{list:e}),a={totalCount:o.length,manualCount:e.length,failedCount:t.length,failedIds:t.join(","),checkContent:i},r=H.template($("#J-check-order-pop-tpl").html(),a),this.confirmPop=H.dialog({title:"人工审核确认",content:r,quickClose:!0,padding:10,backdropOpacity:.3,onremove:function(){}}).show()},this.getInputListHtml=function(e,t,r){var a=[];return t&&t.length>0&&t.forEach(function(t,i){a.push("<em>"),a.push('<input type="text" oninput="orders.orderOperationsCheck.changeTotalPay(this, '+i+');" data-field="'+e+'" data-sub-index="'+i+'" data-index="'+r+'" value="'+(t.value||0)+'">'),a.push("￥</em>")}),a.join("")},this.getPointsHtml=function(e,t){var r=[];return t&&t.length>0&&t.forEach(function(t){r.push('<span style="display:block" data-field="'+e+'">'+(t.value||0)+"</span>")}),r.join("")},this.doManualCheck=function(e,t){var r,a=$("#J-check-order-pop .check-order-pop-content");return t===!0&&(r=this.doValidateFields(a.eq(e)),r.res!==!0)?(H.alert(r.msg,4e3),!1):(e<this.manualList.length&&(t===!0&&this.count++,a.eq(e).hide(),e+1<this.manualList.length&&a.eq(e+1).show()),void(e===this.manualList.length-1&&this.sendManualRequest()))},this.doValidateFields=function(e){var t=e.find('input[data-field="delivery_amount"]').val(),r=e.find('input[data-field="gift_coupon"]'),a=e.find('input[data-field="cash_coupon"]'),i=e.find('input[data-field="use_points"]').val(),o={res:!0,msg:""};return t=""!==t&&t?parseInt(t,10):0,i=""!==i&&i?parseInt(i,10):0,0>=t?(o.res=!1,o.msg="物流费用不能小于0",o):r.length>0&&(o=this.checkMoneyList(r,"+","礼品券换购金额不能小于0"),o.res===!1)?o:a.length>0&&(o=this.checkMoneyList(a,"-","现金券抵扣金额不能大于0"),o.res===!1)?o:i>0?(o.res=!1,o.msg="本单使用积分数额不能大于0",o):o},this.checkMoneyList=function(e,t,r){var a={res:!0,msg:""};return e.each(function(){var e=$(this).val();if(e=e&&""!==e?e:0,e=parseInt(e,10),"+"===t){if(0>e)return a.res=!1,a.msg=r,!1}else if(e>0)return a.res=!1,a.msg=r,!1}),a},this.sendManualRequest=function(){var e,t,r=this;this.confirmPop.remove(),this.count>0&&(e="../src/data/do-check-manual-result.json",t=SYS_VARS.INTERFACE_OFC_URL+this.pageObj.orderOperationsConfig["do-check-manual"].url,t=this.pageObj.needMockData?e:t,r.pageObj.loadingBox.show(),$.ajax({url:t,method:"POST",type:"json",timeout:1e4,data:JSON.stringify({data:r.manualList}),headers:{userToken:r.pageObj.orderCurrentUser.getCurrentToken()},success:function(e){r.pageObj.loadingBox.hide(),r.handleCheckAgainSuccess(e)},error:function(){r.pageObj.loadingBox.hide(),H.alert("客审订单失败，请稍后重试")}}))},this.changeTotalPay=function(e,t){var r,a;return e=$(e),a=e.val(),"+"!==a&&"-"!==a&&a&&""!==a?(r=$("#J-check-order-list-content-"+t),this.changeTheTotalValue(e,t,r),void this.updateSubmitList(t,r)):!1},this.changeTheTotalValue=function(e,t,r){var a,i,o,n,s,d,c,l;a=r.find($('span[data-field="total"]').eq("0")),i=r.find($('span[data-field="unpaid_amount"]').eq("0")),n=r.find($('span[data-field="goods_amount"]').eq("0")),o=r.find($('span[data-field="paid_amount"]').eq("0")),"use_points"!==e.attr("data-field")&&(l=0,c=r.find('input[type="text"]').filter(function(){return"use_points"!==$(this).attr("data-field")}),c.each(function(){l+=parseInt($(this).val()||0,10)}),d=parseInt(n.text(),10)+l,s=d-parseInt(o.text(),10),a.text(d),i.text(s))},this.updateSubmitList=function(e,t){var r=this.manualList[e];for(var a in r){var i=t.find('input[data-field="'+a+'"]'),o=t.find('span[data-field="'+a+'"]');i.length>1&&i.each(function(){var e=$(this).attr("data-sub-index");e&&""!==e?r[a][e].value=parseInt($(this).val()||0):r[a]=parseInt($(this).val()||0)}),o.length>1&&(r[a]=parseInt(o.eq(0).val()||0))}},this.handleCheckAgainSuccess=function(e){200===e.code||"200"===e.code?(H.alert("客审订单成功"),this.changeTabToWaitForDelivery()):(H.alert("订单：<br/>"+e.data.join(",</br>")+"</br>审核失败，请稍后重试",4e3),this.manualList=null,this.count=0)}};t.exports=new a},{}],19:[function(e,t,r){"use strict";var a={"do-lock":{id:"do-lock",label:"锁定",event:"do-lock",canDo:function(e,t,r){var a=!1;return e=parseInt(e,10),"true"!==t&&(a=!0),a},url:"ofc/api/order/lock/"},"do-unlock":{id:"do-unlock",label:"解锁",event:"do-unlock",canDo:function(e,t,r){var a=!1;return e=parseInt(e,10),r===!0&&(a=!0),a},url:"ofc/api/order/lock/"},"do-check":{id:"do-check",label:"客审通过",event:"do-check",canDo:function(e,t,r){var a=!1;return e=parseInt(e,10),500>e&&r===!0&&(a=!0),a},url:"ofc/api/order/cs_audit_pass/"},"do-check-manual":{url:"ofc/api/order/cs_audit_data_save/",id:"do-check-manual",label:"人工客审通过",event:"do-check-manual",canDo:function(){return!0}},"do-cut":{id:"do-cut",label:"剪贴",event:"do-cut",canDo:function(e,t,r){var a=!1;return e=parseInt(e,10),500>e&&r===!0&&(a=!0),a},url:"ofc/api/order/cut/"},"do-merge":{id:"do-merge",label:"合并",event:"do-merge",canDo:function(e,t,r){var a=!1;return e=parseInt(e,10),500>e&&r===!0&&(a=!0),a},url:"ofc/api/order/merge/"},"do-separate":{id:"do-separate",label:"拆分",event:"do-separate",canDo:function(e,t,r){var a=!1;return e=parseInt(e,10),500>e&&r===!0&&(a=!0),a},url:"ofc/api/order/split/"},"do-check-revert":{id:"do-check-revert",label:"反审核",event:"do-check-revert",canDo:function(e,t,r){var a=!1;return e=parseInt(e,10),e>=500&&1300>e&&r===!0&&(a=!0),a},url:"ofc/api/order/reverse_audit/"},"do-mark":{id:"do-mark",label:"打标签",event:"do-mark",canDo:function(e,t,r){return r===!0?!0:!1},url:"ofc/api/order/stick_tags/"},"do-pause":{id:"do-pause",label:"暂停",event:"do-pause",canDo:function(e,t,r){return r===!0?!0:!1},url:""},"do-restart":{id:"do-restart",label:"取消暂停",event:"do-restart",canDo:function(e,t,r){return r===!0?!0:!1},url:""},"do-cancel":{id:"do-cancel",label:"取消",event:"do-cancel",canDo:function(e,t,r){return r===!0?!0:!1},url:"ofc/api/order/cancel/"},"do-resend":{id:"do-resend",label:"重新下发",event:"do-resend",canDo:function(e){return e=parseInt(e,10),!0},url:"ofc/api/order/order/redeliver/"},"do-refresh":{id:"do-refresh",label:"刷新",event:"do-refresh",canDo:function(){return!0},url:""}};t.exports=a},{}],20:[function(e,t,r){"use strict";var a=function(){this.pageObj,this.confirmPop=null,this.goods=null,this.init=function(e){this.pageObj=e.pageObj},this.doCutConfirm=function(){var e,t,r=this.pageObj.orderDataGrid.selectedOrderList,a=this;t="../src/data/order-detail.json",e=SYS_VARS.INTERFACE_URL+"order_apiv1/orders/list.json",e=this.pageObj.needMockData?t:e,$.ajax({url:e,method:"GET",type:"json",timeout:1e4,data:{order_id:r[0].order_id},success:function(e){a.handleGetDetailSuccess(e)},error:function(){a.handleError("获取订单商品列表失败，请稍后重试")}})},this.handleGetDetailSuccess=function(e){var t;200!==e.code&&"200"!==e.code||!e.data?this.handleError("获取子订单失败，请稍后重试"):(t=e.data.order_goods,t&&t.length>0&&(this.goods=this.separateGoods(t),this.showGoodsList(this.goods)))},this.separateGoods=function(e){var t=[];return e.forEach(function(e){var r=parseInt(e.order_quantity||0,10);if(r&&r>1)for(var a=0;r>a;a++){var i=JSON.parse(JSON.stringify(e)),o=(parseFloat(e.total_money||0)/r).toFixed(2);i.quantity=1,i.price=o,i.total_money=o,t.push(i)}else e.quantity=1,e.price=e.total_money.toFixed(2),t.push(e)}),t},this.showGoodsList=function(e){var t,r,a=H.template($("#J-cut-order-pop-list-tpl").html(),{list:e});t={orderId:this.pageObj.orderDataGrid.selectedOrderList[0].order_id,cutContent:a},r=H.template($("#J-cut-order-pop-tpl").html(),t),this.confirmPop=H.dialog({title:"剪切订单确认",content:r,quickClose:!0,padding:10,backdropOpacity:.3,onremove:function(){},onshow:function(){}}).show()},this.doCut=function(){var e=this.goods,t=$("#J-cut-order-pop select"),r={},a=0;t.each(function(t){var i=$(this).val()+"";r[i]||(r[i]=[],a++),r[i].push(e[t])}),1>=a?H.alert("将药品分配在不同的选项内，否则订单将不作剪切",4e3):(this.confirmPop.remove(),this.sendCutRequestToServer(r))},this.sendCutRequestToServer=function(e){var t,r,a=this.pageObj.orderDataGrid.selectedOrderList,i=this;r="../src/data/do-cut-result.json",t=SYS_VARS.INTERFACE_OFC_URL+this.pageObj.orderOperationsConfig["do-cut"].url,t=this.pageObj.needMockData?r:t,i.pageObj.loadingBox.show(),$.ajax({url:t,method:"POST",type:"json",timeout:1e4,data:JSON.stringify({order_id:a[0].order_id,order_list:e}),headers:{userToken:i.pageObj.orderCurrentUser.getCurrentToken()},success:function(e){i.pageObj.loadingBox.hide(),i.handleSuccess(e)},error:function(){i.pageObj.loadingBox.hide(),i.handleError("订单"+a[0].order_id+"剪切失败，请稍后重试",4e3)}})},this.doCancel=function(){this.confirmPop.remove()},this.handleSuccess=function(e){var t,r=this.pageObj.orderDataGrid.selectedOrderList,a=this;200===e.code||"200"===e.code||0===e.code||"0"===e.code?(this.handleError("订单"+r[0].order_id+"剪切成功"),this.showNewOrders(e.data),this.changeTabToAll()):(t=e.msg&&""!==e.msg?e.msg+"<br/>":"",a.handleError(t+"订单"+r[0].order_id+"剪切失败，请稍后重试",4e3))},this.showNewOrders=function(e){var t,r=this.pageObj.orderDataGrid.selectedOrderList;e.map(function(e){e.order_quantity=e.quantity,e.total=parseFloat(e.total||0).toFixed(2)}),t=H.template($("#J-cut-order-pop-order-list-tpl").html(),{list:e}),t="<p>订单成功剪切成以下几个订单：</p>"+t,H.dialog({title:r[0].order_id+"剪切成功",content:t,width:400,quickClose:!0,padding:10,backdropOpacity:.3}).show()},this.changeTabToAll=function(){var e=$("#tabStatusFilter li:eq(0)");this.pageObj.orderTabFilter.toggleTab(e)},this.handleError=function(e,t){H.alert(e,t||2e3)}};t.exports=new a},{}],21:[function(e,t,r){"use strict";var a=function(){this.pageObj,this.init=function(e){this.pageObj=e.pageObj,this.currentEventType=1,this.typeStr="锁定"},this.doLockUnlock=function(e){var t,r,a=this.pageObj.orderDataGrid.selectedOrderList,i=[],o=this;this.currentEventType=e,a.forEach(function(e){i.push(e.order_id)}),r="../src/data/do-lock-result.json",1===e?(t=SYS_VARS.INTERFACE_OFC_URL+this.pageObj.orderOperationsConfig["do-lock"].url,this.typeStr="锁定"):(t=SYS_VARS.INTERFACE_OFC_URL+this.pageObj.orderOperationsConfig["do-unlock"].url,this.typeStr="解锁"),t=this.pageObj.needMockData?r:t,o.pageObj.loadingBox.show(),$.ajax({url:t,method:"POST",type:"json",timeout:1e4,data:JSON.stringify({order_ids:i,is_lock:1===e?1:0,locker:o.pageObj.orderCurrentUser.info.userId}),headers:{userToken:o.pageObj.orderCurrentUser.getCurrentToken()},success:function(e){o.pageObj.loadingBox.hide(),o.handleSuccess(e)},error:function(){o.pageObj.loadingBox.hide(),H.alert(this.typeStr+"订单失败，请稍后重试")}})},this.handleSuccess=function(e){200===e.code||"200"===e.code?(H.alert(this.typeStr+"订单成功"),this.changeTabToWaitForCheck()):this.handleError(e)},this.changeTabToWaitForCheck=function(){var e=1===this.currentEventType?$("#tabStatusFilter li:eq(2)"):$("#tabStatusFilter li:eq(1)");this.pageObj.orderTabFilter.toggleTab(e)},this.handleError=function(e,t){t=t||3e3,e.data&&e.data.length>0?H.alert("订单：<br/>"+e.data.join(",</br>")+"</br>"+this.typeStr+"失败，请重试",t):H.alert(e.msg+"<br/>"+this.typeStr+"失败，请重试",t),e.data&&e.data.length<this.pageObj.orderDataGrid.selectedOrderList.length&&this.changeTabToAll()},this.changeTabToAll=function(){var e;e=$("#tabStatusFilter li:eq(0)"),this.pageObj.orderTabFilter.toggleTab(e)}};t.exports=new a},{}],22:[function(e,t,r){"use strict";var a=function(){this.pageObj,this.confirmPop=null,this.tag_ids=[],this.init=function(e){this.pageObj=e.pageObj},this.getMarkList=function(){var e,t,r=this;t="../src/data/get-mark-lsit-result.json",e=SYS_VARS.INTERFACE_OFC_URL+"ofc/api/order/stick_tags/",e=this.pageObj.needMockData?t:e,r.pageObj.loadingBox.show(),$.ajax({url:e,method:"GET",type:"json",timeout:1e4,data:{cs_id:this.pageObj.orderCurrentUser.info.userId},headers:{userToken:r.pageObj.orderCurrentUser.getCurrentToken()},success:function(e){r.pageObj.loadingBox.hide(),r.showMarkList(e)},error:function(){r.pageObj.loadingBox.hide(),r.handleError("获取标签列表失败，请稍后重试")}})},this.showMarkList=function(e){var t,r=["暂停","取消暂停","取消订单"];("200"===e.code||200===e.code)&&e.data&&e.data.length>0?(e.data.map(function(e){for(var t=0;t<r.length;t++)e.tag_name===r[t]&&(e.needHide=!0)}),t=H.template($("#J-mark-order-pop-tpl").html(),{list:e.data}),this.confirmPop=H.dialog({title:"选择标签",content:t,width:400,quickClose:!0,padding:10,backdropOpacity:.3}).show()):H.alert("获取标签列表失败，请稍后重试")},this.markToggle=function(e){var t,r;if(e=$(e),t=e.attr("data-tag-code"),e.hasClass("active")){e.removeClass("active");for(var a=0;a<this.tag_ids.length;a++)if(this.tag_ids[a]===t){console.info("i:"+a),r=a;break}null!==r&&(this.tag_ids.splice(r,1),r=null)}else e.addClass("active"),this.tag_ids.push(t)},this.doMark=function(){var e,t,r=this.pageObj.orderDataGrid.selectedOrderList,a=this,i=[];return this.tag_ids.length<=0?!1:(t="../src/data/do-lock-result.json",e=SYS_VARS.INTERFACE_OFC_URL+this.pageObj.orderOperationsConfig["do-mark"].url,e=this.pageObj.needMockData?t:e,r.forEach(function(e){i.push(e.order_id)}),a.pageObj.loadingBox.show(),void $.ajax({url:e,method:"POST",type:"json",timeout:1e4,data:JSON.stringify({order_ids:i,tag_ids:this.tag_ids,cs_id:this.pageObj.orderCurrentUser.info.userId}),success:function(e){a.pageObj.loadingBox.hide(),a.handleSuccess(e)},error:function(){a.pageObj.loadingBox.hide(),a.handleError("订单添加标签失败，请稍后重试")}}))},this.doCancel=function(){this.clearMakeTagPanel()},this.handleSuccess=function(e){this.clearMakeTagPanel(),200===e.code||"200"===e.code?(H.alert("订单操作成功"),this.pageObj.orderDataGrid.refreshDataGrid()):this.handleError("订单：<br/>"+e.data.join("<br/>")+"<br/>添加标签失败，请稍后重试",4e3)},this.handleError=function(e,t){H.alert(e,t||2e3)},this.clearMakeTagPanel=function(){this.confirmPop&&this.confirmPop.remove(),this.tag_ids=[]}};t.exports=new a},{}],23:[function(e,t,r){"use strict";var a=function(){this.pageObj,this.confirmPop=null,this.goods=null,this.init=function(e){this.pageObj=e.pageObj},this.doMergeConfirm=function(){var e,t,r=this.pageObj.orderDataGrid.selectedOrderList;r=JSON.parse(JSON.stringify(r)),e=H.template($("#J-cut-order-pop-order-list-tpl").html(),{list:r}),t=H.template($("#J-merge-order-pop-tpl").html(),{cutContent:e}),this.confirmPop=H.dialog({title:"合并订单确认",content:t,width:400,quickClose:!0,padding:10,backdropOpacity:.3}).show()},this.doMerge=function(){var e,t,r=this.pageObj.orderDataGrid.selectedOrderList,a=this,i=[];t="../src/data/do-merge-result.json",e=SYS_VARS.INTERFACE_OFC_URL+this.pageObj.orderOperationsConfig["do-merge"].url,e=this.pageObj.needMockData?t:e,r.forEach(function(e){i.push(e.order_id)}),a.pageObj.loadingBox.show(),$.ajax({url:e,method:"POST",type:"json",timeout:1e4,data:JSON.stringify({order_ids:i}),headers:{userToken:a.pageObj.orderCurrentUser.getCurrentToken()},success:function(e){a.pageObj.loadingBox.hide(),a.handleSuccess(e,i)},error:function(){a.pageObj.loadingBox.hide(),a.handleError("订单：<br/>"+i.join("<br/>")+"<br/>合并失败，请稍后重试",4e3)}})},this.doCancel=function(){this.confirmPop.remove()},this.handleSuccess=function(e,t){this.confirmPop.remove(),200===e.code||"200"===e.code?(this.showNewOrders(e.data),this.changeTabToAll()):this.handleError("订单：<br/>"+t.join("<br/>")+"<br/>合并失败，请稍后重试",4e3)},this.showNewOrders=function(e){var t;e[0].order_quantity=e[0].quantity,t=H.template($("#J-cut-order-pop-order-list-tpl").html(),{list:e}),H.dialog({title:"合并成功",content:t,width:400,quickClose:!0,padding:10,backdropOpacity:.3}).show()},this.changeTabToAll=function(){var e=$("#tabStatusFilter li:eq(0)");this.pageObj.orderTabFilter.toggleTab(e)},this.handleError=function(e,t){H.alert(e,t||2e3)}};t.exports=new a},{}],24:[function(e,t,r){"use strict";var a=function(){this.pageObj,this.confirmPop=null,this.type=null,this.init=function(e){this.pageObj=e.pageObj},this.doConfirm=function(e){var t,r=this.pageObj.orderDataGrid.selectedOrderList,a=[],i=[];this.type=e,t=1===this.type?"暂停":"取消暂停",r.forEach(function(e){a.push(e.order_id)}),i.push('<div class="button-row">'),i.push("请确认你要"+t+"的订单：<br/>"+a.join("，<br/>")+"<br/><br/>"),i.push("</div>"),i.push('<div class="button-row">'),i.push('<input type="button" class="btn btn-sm btn-gray" value="取消" onclick="orders.orderOperationsPauseRestart.doCancel();"> '),i.push('<input type="button" class="btn btn-sm btn-primary" value="确认" onclick="orders.orderOperationsPauseRestart.doPauseOrRestart();">'),i.push("</div>"),this.confirmPop=H.dialog({title:t+"订单确认",content:i.join(""),width:400,quickClose:!0,padding:10,backdropOpacity:.3}).show()},this.doPauseOrRestart=function(){var e;e=1===this.type?$('#optionPanel input[data-event="do-pause"]'):$('#optionPanel input[data-event="do-cancel"]'),this.confirmPop.remove(),this.pageObj.orderOperationsMark.tag_ids=[],this.pageObj.orderOperationsMark.tag_ids.push(e.attr("data-tag-code")),this.pageObj.orderOperationsMark.doMark()},this.doCancel=function(){this.confirmPop.remove()},this.handleSuccess=function(e,t){this.confirmPop.remove(),200===e.code||"200"===e.code?H.alert("订单：<br/>"+t.join("<br/>")+"<br/>"+(1===this.type?"暂停":"取消暂停")+"成功"):this.handleError("订单：<br/>"+e.data.join("<br/>")+"<br/>"+(1===this.type?"暂停":"取消暂停")+"失败，请稍后重试",4e3)},this.changeTabToAll=function(){this.pageObj.orderDataGrid.refreshDataGrid()},this.handleError=function(e,t){H.alert(e,t||2e3)}};t.exports=new a},{}],25:[function(e,t,r){"use strict";var a=function(){this.pageObj,this.confirmPop=null,this.goods=null,this.init=function(e){this.pageObj=e.pageObj},this.doConfirm=function(){var e,t,r=this.pageObj.orderDataGrid.selectedOrderList,a=this;t="../src/data/get-separate-order-list.json",e=SYS_VARS.INTERFACE_OFC_URL+"ofc/api/order/split_info/",e=this.pageObj.needMockData?t:e,$.ajax({url:e,method:"GET",type:"json",timeout:1e4,headers:{userToken:a.pageObj.orderCurrentUser.getCurrentToken()},data:{order_id:r[0].order_id},success:function(e){200===e.code||"200"===e.code?a.showConfirmBox(e.data):a.handleError("获取订单："+r[0].order_id+"的子订单失败，请稍后重试",4e3)},error:function(){a.handleError("获取订单："+r[0].order_id+"的子订单失败，请稍后重试",4e3)}})},this.showConfirmBox=function(e){var t,r,a=this.pageObj.orderDataGrid.selectedOrderList;a=JSON.parse(JSON.stringify(a)),t=H.template($("#J-cut-order-pop-order-list-tpl").html(),{list:e}),r=H.template($("#J-separate-order-pop-tpl").html(),{cutContent:t,order_id:a[0].order_id}),this.confirmPop=H.dialog({title:"拆分订单确认",content:r,width:400,quickClose:!0,padding:10,backdropOpacity:.3}).show()},this.doSeparate=function(){var e,t,r=this.pageObj.orderDataGrid.selectedOrderList,a=this;t="../src/data/do-check-result.json",e=SYS_VARS.INTERFACE_OFC_URL+this.pageObj.orderOperationsConfig["do-separate"].url,e=this.pageObj.needMockData?t:e,a.pageObj.loadingBox.show(),$.ajax({url:e,method:"POST",type:"json",timeout:1e4,data:JSON.stringify({order_id:r[0].order_id}),headers:{userToken:a.pageObj.orderCurrentUser.getCurrentToken()},success:function(e){a.pageObj.loadingBox.hide(),a.handleSuccess(e)},error:function(){a.pageObj.loadingBox.hide(),a.handleError("订单："+r[0].order_id+"拆分失败，请稍后重试",4e3)}})},this.doCancel=function(){this.confirmPop.remove()},this.handleSuccess=function(e){var t=this.pageObj.orderDataGrid.selectedOrderList;this.confirmPop.remove(),200===e.code||"200"===e.code?H.alert("订单："+t[0].order_id+"拆分成功"):this.handleError("订单："+t[0].order_id+"拆分失败，请稍后重试",4e3)},this.changeTabToAll=function(){var e=$("#tabStatusFilter li:eq(0)");this.pageObj.orderTabFilter.toggleTab(e)},this.handleError=function(e,t){H.alert(e,t||2e3)}};t.exports=new a},{}],26:[function(e,t,r){"use strict";var a=function(){this.pageObj,this.init=function(e){this.pageObj=e.pageObj,this.addEvent()},this.doRefreshData=function(){this.pageObj.orderDataGrid.refreshDataGrid()},this.handleClick=function(e){var t=e.target,r=t.tagName.toLowerCase(),a=t.getAttribute("data-event");"input"===r&&"do-refresh"===a?this.doRefreshData():"input"===r&&"do-lock"===a?this.pageObj.orderOperationsLockUnLock.doLockUnlock(1):"input"===r&&"do-unlock"===a?this.pageObj.orderOperationsLockUnLock.doLockUnlock(0):"input"===r&&"do-check"===a?this.pageObj.orderOperationsCheck.doCheckConfirm():"input"===r&&"do-cut"===a?this.pageObj.orderOperationsCut.doCutConfirm():"input"===r&&"do-merge"===a?this.pageObj.orderOperationsMerge.doMergeConfirm():"input"===r&&"do-separate"===a?this.pageObj.orderOperationsSeparate.doConfirm():"input"===r&&"do-check-revert"===a?this.pageObj.orderOperationsCheckRevert.doConfirm():"input"===r&&"do-mark"===a?this.pageObj.orderOperationsMark.getMarkList():"input"===r&&"do-cancel"===a?this.pageObj.orderOperationsCancel.doConfirm():"input"===r&&"do-pause"===a?this.pageObj.orderOperationsPauseRestart.doConfirm(1):"input"===r&&"do-restart"===a?this.pageObj.orderOperationsPauseRestart.doConfirm(0):"input"===r&&"do-resend"===a&&this.pageObj.orderOperationsResend.doConfirm()},this.resetOptionsStatus=function(e){var t={},r=this.pageObj.orderOperationsConfig,a={},i=this;$('#optionPanel input[type="button"]').each(function(){var e=$(this).attr("data-event");e&&""!==e&&(t[e]=$(this)),"do-refresh"!==e&&i.buttonSetStatus($(this),!1)}),e.forEach(function(e){for(var t in r){var o,n,s,d,c;o=r[t],s=i.pageObj.orderCurrentUser.info.userId,d=e.locker_cs_id&&""!==e.locker_cs_id?parseInt(e.locker_cs_id,10):-1,c=s&&s===d?!0:!1,n=o.canDo(e.order_status,e.is_lock,c),n===!0&&(null===a[t]||void 0===a[t]||"do-check-revert"===t||"do-cut"===t||"do-separate"===t||"do-pause"===t||"do-separate"===t||"do-restart"===t||"do-cancel"===t?a[t]=1:a[t]++);
}});for(var o in a)t[o]&&a[o]===e.length&&("do-merge"===o?a[o]>=2&&i.buttonSetStatus(t[o],!0):i.buttonSetStatus(t[o],!0))},this.buttonSetStatus=function(e,t){var r="btn btn-sm btn-gray",a="btn btn-sm btn-primary";e.attr("class",t===!0?a:r),t===!1?e.attr("disabled","disabled"):e.removeAttr("disabled")},this.clearOperationButtonStatus=function(){var e=this;$('#optionPanel input[type="button"]').each(function(){var t=$(this).attr("data-event");"do-refresh"===t?e.buttonSetStatus($(this),!0):e.buttonSetStatus($(this),!1)})},this.addEvent=function(){var e=$("#optionPanel");e.bind("click",function(e){this.handleClick(e)}.bind(this))}};t.exports=new a},{}],27:[function(e,t,r){"use strict";var a=function(){this.searchParams={tab_id:1,order_ids:"",source_orders:"",shop_id:-1,use_place_date:-1,order_date_start:"",order_date_end:"",waybill_num:"",order_status:-1,oper_id:-1,cs_id:-1,user_phone:"",sku_or_goods_name:"",payment_type:-1,consignee_name:"",consignee_mobile:"",data_format:"jqgrid"},this.pageObj,this.callback;var e=function(e,t){var r=[];e.forEach(function(e){r.push('<option value="'+e.value+'">'+e.label+"</option>")}),t.html(r.join(""))},t=function(e){var t,r=[],a={};return e.forEach(function(e){a[e]!==!0&&(a[e]=!0,/^[\d|\w]+$/.test(e)?r.push(e.replace(/\s/g,"")):(t=e.match(/\d|\w/g),t&&t.length>1&&r.push(t.join(""))))}),r},r=function(e){var r;return r=e&&""!==e?e.split("\n"):[],r&&r.length>=0&&(r=t(r)),r.join(",")},a=function(e,t){var r={res:!1};return t&&""!==t?e&&""!==e?e>t?r.msg="开始时间不能大于结束时间":r.res=!0:r.msg="请输入开始时间进行查询":e&&""!==e?r.msg="请输入结束时间进行查询":r.res=!0,r};this.init=function(e){this.pageObj=e.pageObj,this.initCallback=e.callback,this.initDatePicker(),this.getCustomLocker(),this.getShops(),this.buildAllSelectList(),this.addEvent()},this.buildAllSelectList=function(){e(this.pageObj.orderFilters.ORDER_STATUS,$("#OrderStatus")),e(this.pageObj.orderFilters.OPERATION_ITEMS,$("#Operation"))},this.getCustomLocker=function(){var e,t,r=this;t="../src/data/get-serivers.json",e=SYS_VARS.INTERFACE_URL_NODE+"user/listByIdentity",e=this.pageObj.needMockData?t:e,$.ajax({url:e,method:"GET",dataType:"jsonp",timeout:1e4,data:{token:r.pageObj.orderCurrentUser.getCurrentToken(),identityId:parseInt(r.pageObj.orderCurrentUser.info.userIdentity,10)},success:function(e){r.fillLockersList(e)},error:function(){r.handleGetCSFailed()}})},this.fillLockersList=function(e){var t,r=[],a=$("#searchInputPanel #Locker");r.push('<option value="-1">选择锁定人</option>'),1===e.code||"1"===e.code?(t=e.data.list,t&&t.length>0&&(t.forEach(function(e){var t="";r.push('<option value="'+e.id+'" '+t+">"+(e.user_real_name||e.user_nick_name)+"</option>")}),a.html(r.join("")))):H.alert("获取所有用户失败，请刷新页面重试")},this.getShops=function(){var e,t,r=this;t="../src/data/get-shops-result.json",e=SYS_VARS.INTERFACE_URL+"order_apiv1/order/platform_shops",e=this.pageObj.needMockData?t:e,$.ajax({url:e,type:"GET",dataType:"json",success:function(e){r.fillShopsList(e)},error:function(){H.alert("获取销售平台列表失败，请刷新页面重试")}})},this.fillShopsList=function(e){var t,r=[],a=$("#searchInputPanel #salePlatform");r.push('<option value="-1">选择销售店铺</option>'),200===e.code||"200"===e.code?(t=e.data,t&&t.length>0&&(t.forEach(function(e){var t="";r.push('<option value="'+(e.shop_id||-1)+'" '+t+">"+(e.shop_name||"")+"</option>")}),a.html(r.join("")))):H.alert((e.msg&&""!==e.msg?e.msg+"<br/>":"")+"获取销售平台列表失败，请刷新页面重试")},this.handleGetCSFailed=function(){},this.doSearch=function(){var e,t,i,o=$("#searchInputPanel");return e=o.find("#StartDate").val(),t=o.find("#EndDate").val(),i=a(e,t),i.res!==!0?(H.alert(i.msg),!1):(this.searchParams.order_ids=r(o.find("#orderNo").val()),this.searchParams.source_orders=r(o.find("#salesNo").val()),this.searchParams.shop_id=o.find("#salePlatform").val(),this.searchParams.use_place_date=o.find("#orderTime").val(),this.searchParams.order_date_start=e,this.searchParams.order_date_end=t,this.searchParams.waybill_num=o.find("#ShippingNo").val(),this.searchParams.order_status=o.find("#OrderStatus").val(),this.searchParams.oper_id=o.find("#Operation").val(),this.searchParams.cs_id=o.find("#Locker").val(),this.searchParams.user_phone=o.find("#MemPhone").val(),this.searchParams.sku_or_goods_name=o.find("#GoodsSku").val(),this.searchParams.payment_type=o.find("#payment").val(),this.searchParams.consignee_name=o.find("#Receiver").val(),this.searchParams.consignee_mobile=o.find("#ReceiverPhone").val(),void this.pageObj.orderDataGrid.refreshDataGrid(this.searchParams))},this.doReset=function(){var e,t;this.searchParams={},t=$('#searchInputPanel input[type="text"]'),t.val(""),e=$("#searchInputPanel  select"),e.each(function(){var e=$(this).find("option");e.removeAttr("selected"),e.eq(0).attr("selected","selected")})},this.doOutput=function(){},this.handleClick=function(e){var t=e.target,r=t.tagName.toLowerCase(),a=t.getAttribute("data-event");"input"===r&&"do-search"===a?this.doSearch():"input"===r&&"do-reset"===a?this.doReset():"input"===r&&"do-output"===a&&this.doOutput()},this.initDatePicker=function(){var e=$("#StartDate"),t=$("#EndDate"),r={format:"yyyy-mm-dd hh:ii",autoclose:!0,todayBtn:!0,startDate:"2016-01-01 00:00",minuteStep:5};e.datetimepicker(r),t.datetimepicker(r),e.datetimepicker("setStartDate","2009-01-01"),t.datetimepicker("setStartDate","2009-01-01"),setTimeout(function(){this.dateTimePickerResetPosition()}.bind(this),50)},this.dateTimePickerResetPosition=function(){var e=$('#searchInputPanel input[data-type="datetime"]'),t=$(".datetimepicker");e.each(function(e,r){var a,i;r=$(r),a=r.offset().top+r.outerHeight(),i=r.offset().left,t.eq(e).css({top:a+"px",left:i+"px"})})},this.addEvent=function(){var e=$("#searchInputPanel");e.bind("click",function(e){this.handleClick(e)}.bind(this)),$(window).bind("resize",function(){this.dateTimePickerResetPosition()}.bind(this))}};t.exports=new a},{}],28:[function(e,t,r){"use strict";var a=function(){this.pageObj,this.currentStatus=1,this.toggleTab=function(e){e.hasClass("active")||(this.currentStatus=parseInt(e.attr("data-status"),10),e.siblings("li").removeClass("active"),e.addClass("active"),this.pageObj&&this.pageObj.orderSearch&&(this.pageObj.orderSearch.searchParams.tab_id=this.currentStatus,this.pageObj.orderSearch.doSearch()))},this.init=function(e){this.pageObj=e.pageObj,this.addEvent()},this.handleClick=function(e){var t=e.target,r=t.tagName.toLowerCase();t=$(t),"li"===r&&t.hasClass("item")&&this.toggleTab(t)},this.addEvent=function(){var e=$("#tabStatusFilter");e.bind("click",function(e){this.handleClick(e)}.bind(this))}};t.exports=new a},{}],29:[function(e,t,r){var a={doFormat:function(e){return e&&""!==e&&"null"!==e&&"undefined"!==e&&(e=e.replace(/T/g," ").replace(/Z/g,"")),e}};t.exports=a},{}],30:[function(e,t,r){window.loading={show:function(){$("body").append('<div id="J-loading" class="cm-loading"></div>')},hide:function(){$("#J-loading").remove()}},t.exports=window.loading},{}]},{},[1]);